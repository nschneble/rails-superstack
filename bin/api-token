#!/usr/bin/env ruby

DEFAULT_EMAIL = "api@superstack.dev"
TOKEN_NAME = "Local token"

if ARGV.include?("-h") || ARGV.include?("--help")
  puts "Usage: bin/api-token [email]"
  puts
  puts "Generates a bearer token for GraphQL requests."
  puts "Default email: #{DEFAULT_EMAIL}"
  exit 0
end

require_relative "../config/environment"

email = ARGV.first || DEFAULT_EMAIL
user  = User.find_or_create_by!(email: email)
token = ApiToken.issue!(user:, name: TOKEN_NAME)

puts "Bearer #{token.plaintext_token}"
